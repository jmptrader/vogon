{{define "content"}}
<div class="row">
	{{$viewMode := or (.Deleted) (eq .User .CurrentUser.Id)}}
	<div class="col-lg-12">
		<h1 class="page-header">
			Users <small><small>are the individuals managing secrets and consumers.</small></small>
		</h1>
		<ol class="breadcrumb">
			<li><i class="fa fa-dashboard"></i> <a href="/">Dashboard</a></li>
			<li><i class="fa fa-users"></i> <a href="/users">Users</a></li>
			<li class="active">{{if .User}}{{if $viewMode}}<i class="fa fa-user"></i> View{{else}}<i class="fa fa-pencil"></i> Edit{{end}}{{else}}<i class="fa fa-plus"></i> New{{end}}</li>
		</ol>
	</div>
</div>

<div class="row">
	<div class="col-lg-10 col-lg-offset-1">
		<div class="well">
			{{if $viewMode}}
			<div class="form-group">
				<label for="name" class="control-label">Name:</label>
				<p class="form-control-static" id="name">{{.Name}}</p>
			</div>

			<div class="form-group">
				<label for="login" class="control-label">Login:</label>
				<p class="form-control-static" id="login">{{.LoginName}}</p>
			</div>
			{{else}}
			<form method="post" action="{{if .User}}/users/{{.User}}{{else}}/users{{end}}" role="form">
				<div class="form-group{{if .NameError}} has-error{{end}}">
					<input type="hidden" name="_csrf" value="{{.CsrfToken}}">
					{{if .User}}<input type="hidden" name="_method" value="PUT">{{end}}
					<label for="name" class="control-label">Name:</label>
					<input class="form-control" id="name" name="name" value="{{.Name}}" required placeholder="Peter Gibbons">
					<p class="help-block">
						{{if .NameError}}{{.NameError}}{{else}}Each user should have a name that the root user can recognize.{{end}}
					</p>
				</div>

				<div class="form-group{{if .LoginError}} has-error{{end}}">
					<label for="login" class="control-label">Login:</label>
					<input class="form-control" id="login" name="login" value="{{.LoginName}}" required placeholder="pgibbons">
					<p class="help-block">
						{{if .LoginError}}{{.LoginError}}{{else}}The login must be alphanumeric and unique.{{end}}
					</p>
				</div>

				<div class="form-group{{if .PasswordError}} has-error{{end}}">
					<label for="password" class="control-label">Passphrase:</label>
					<input class="form-control" type="password" id="password" name="password" {{if not .User}}required{{end}}>
					<p class="help-block">
						{{if .PasswordError}}{{.PasswordError}}{{else}}Choose a strong passphrase.{{end}}
					</p>
				</div>

				{{if .User}}
				<div class="pull-right">
					<a class="btn btn-danger" href="/users/{{.User}}/delete"><i class="fa fa-trash-o"></i> Delete</a>
				</div>
				{{end}}

				<div>
					<button type="submit" class="btn btn-primary"><i class="fa fa-check"></i> {{if .User}}Update{{else}}Save{{end}}</button>
					<button type="reset" class="btn btn-default"><i class="fa fa-undo"></i> Reset</button>
				</div>
			</form>
			{{end}}
		</div>

		{{if .Deleted}}
		<div class="alert alert-info">
			This user has been deleted and the account is only kept for archival purpose. You cannot make any changes to it anymore.
		</div>
		{{else}}
			{{if eq .User .CurrentUser.Id}}
			<div class="alert alert-info">
				You cannot edit yourself here. Use your <a href="/profile">profile</a> (top right corner of the page) to change your information.
			</div>
			{{end}}
		{{end}}

		{{if .OtherError}}
		<div class="alert alert-danger">
			<strong>Aw snap.</strong> {{.OtherError}}
		</div>
		{{end}}
	</div>
</div>
{{end}}
